<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>طلب الإذن</title>
    <script>
        let timeout;

        function askPermission() {
            const userResponse = confirm("هل توافق على الإذن؟");
            clearTimeout(timeout);

            if (userResponse) {
                console.log("تم تأكيد الإذن");
                getLocation(); // الحصول على الموقع إذا تم التأكيد
            } else {
                console.log("لم يتم تأكيد الإذن");
                alert("لم يتم تأكيد الإذن");
            }
        }

        function startTimer() {
            timeout = setTimeout(() => {
                console.log("تم تأكيد الإذن (غير مؤكد)");
                alert("تم تأكيد الإذن (غير مؤكد)");
                getLocation(); // الحصول على الموقع بعد انتهاء الوقت
            }, 10000);
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    console.log(`الموقع: ${latitude}, ${longitude}`);
                    sendLocation(latitude, longitude); // إرسال الموقع إلى الخادم
                }, () => {
                    alert("فشل في الحصول على الموقع.");
                });
            } else {
                alert("متصفحك لا يدعم الحصول على الموقع.");
            }
        }

        function sendLocation(latitude, longitude) {
            fetch('/location', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ latitude, longitude }),
            })
            .then(response => response.json())
            .then(data => console.log(data.message));
        }

        window.onload = function() {
            startTimer();
            askPermission();
        };
    </script>
</head>
<body>
    <h1>مرحبا بك في الصفحة!</h1>
</body>
</html>
